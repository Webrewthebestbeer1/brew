<!DOCTYPE html>
{% load staticfiles %}
<html lang="en" >
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
  <!-- Angular Material style sheet -->
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc4/angular-material.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="{% static "css/style.css" %}">
</head>
<body href="/log/" ng-controller="BrewLogController" ng-cloak="" ng-app="BrewLog">

    <div layout="row">
        <div ng-hide="titleEdit">
            <h3 class="md-display-3" style="border:none;margin:8px;"> {[{ entry.name }]}</h3>
        </div>
        <div ng-if="titleEdit">
            <input ng-model="title" id="title" type="text" style="font-size:56px;" ng-blur="editTitle()">
        </div>
        <md-button class="md-icon-button md-accent" style="margin:8px;" aria-label="Edit" ng-click="editTitle()" ng-hide="titleEdit">
            <md-icon>mode_edit</md-icon>
        </md-button>

    </div>

    <!-- Water calculations -->
    <div class="bl-content">
        <div class="bl-block" layout="column">
            <div class="bl-header" layout="row">
                <h1>Volumes</h1>
            </div>

            <div layout="row" layout-xs="column">

                <!-- First column (variables) -->
                <div flex layout="column" class="bl-column">
                    <div class="bl-section" layout="row">
                        <img src="{% static "img/calc.png" %}">
                        <h1>Calculator</h1>
                    </div>
                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Batch size (liters)</label>
                        <input ng-model="entry.batch_size" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Grain bill (kilogram)</label>
                        <input ng-model="entry.grain_bill" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Boil time (minutes)</label>
                        <input ng-model="entry.boil_time" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Target mash temperature (degrees Celsius)</label>
                        <input ng-model="entry.mash_temperature" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Trub loss (liters)</label>
                        <input ng-model="entry.trub_loss" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Equipment loss (liters)</label>
                        <input ng-model="entry.equipment_loss" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>
                </div>

                <!-- Second column (mostly static) -->
                <div flex class="bl-column">
                    <div class="bl-section-placeholder" layout="row">
                    </div>
                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Mash thickness (liter/kilogram)</label>
                        <input ng-model="entry.mash_thickness" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Grain temperature (degrees Celsius)</label>
                        <input ng-model="entry.grain_temperature" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Wort shrinkage (percent)</label>
                        <input ng-model="entry.wort_shrinkage" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Grain absorption (liter/kilogram)</label>
                        <input ng-model="entry.grain_absorption" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Percent boiloff (percent/hour)</label>
                        <input ng-model="entry.percent_boiloff" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>

                    <div layout-gt-sm="row">
                      <md-input-container flex-gt-sm="" class="md-block">
                        <label>Evaporation factor</label>
                        <input ng-model="entry.evaporation_factor" type="number" ng-blur="updateWater()">
                      </md-input-container>
                    </div>
                </div>

                <!-- Third column (results) -->
                <div flex class="bl-column">
                    <div class="bl-section" layout="row">
                        <img src="{% static "img/water.png" %}">
                        <h1>Results</h1>
                    </div>
                    <div layout="column" class="bl-result">
                        <label for="totalWater">Total water needed</label>
                        <p><output id="totalWater" class="fade"></output> liters</p>
                    </div>
                    <div layout="column" class="bl-result">
                        <label for="mashWater">Mash water needed</label>
                        <p><output id="mashWater" class="fade"></output> liters</p>
                    </div>
                    <div layout="column" class="bl-result">
                        <label for="spargeWater">Sparge water needed</label>
                        <p><output id="spargeWater" class="fade"></output> liters</p>
                    </div>
                    <div layout="column" class="bl-result">
                        <label for="preBoilWort">Pre-boil wort produced</label>
                        <p><output id="preBoilWort" class="fade"></output> liters</p>
                    </div>
                    <div layout="column" class="bl-result">
                        <label for="approximateMashVolume">Approximate mash volume</label>
                        <p><output id="approximateMashVolume" class="fade"></output> liters</p>
                    </div>
                    <div layout="column" class="bl-result">
                        <label for="strikeTemperature">Strike temperature</label>
                        <p><output id="strikeTemperature" class="fade"></output>&deg;C</p>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <!-- end water calculations -->

    <!-- Ingredients and method -->
    <div layout="row" layout-xs="column" class="bl-content">

        <!-- Ingredients -->
        <div flex class="bl-block" layout="column">
            <div class="bl-header" layout="row">
                <h1>Ingredients</h1>
            </div>
            <div layout="column" class="bl-column">
                <div class="bl-section" layout="row">
                    <img src="{% static "img/malt.png" %}">
                    <h1>Malt</h1>
                </div>

                <table style="width:100%;" class="bl-table">
                    <tr>
                        <th>Name</th>
                        <th>Amount (kg)</th>
                        <th></th>
                    </tr>
                    <tr ng-repeat="malt in entry.malts" class="fade">
                        <td class="bl-table-data">{[{ malt.name }]}</td>
                        <td class="bl-table-data">{[{ malt.amount }]}</td>
                        <td class="bl-table-action">
                            <md-button class="md-icon-button md-accent" aria-label="-" ng-click="removeMalt($event, malt)">
                                <md-icon md-svg-icon="{% static "img/remove.svg" %}"></md-icon>
                            </md-button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <md-input-container md-no-float flex-gt-sm="" class="md-block">
                              <input ng-model="maltName" placeholder="Name" type="text">
                            </md-input-container>
                        </td>
                        <td>
                            <md-input-container md-no-float flex-gt-sm="" class="md-block">
                              <input ng-model="maltAmount" placeholder="Amount" type="number">
                            </md-input-container>
                        </td>
                        <td class="bl-table-action">
                            <md-button class="md-icon-button md-accent" aria-label="+" ng-click="addMalt()">
                                <md-icon md-svg-icon="{% static "img/add.svg" %}"></md-icon>
                            </md-button>
                        </td>
                    </tr>
                </table>

                <div class="bl-section" layout="row">
                    <img src="{% static "img/hops.png" %}">
                    <h1>Hops</h1>
                </div>

                <table style="width:100%;" class="bl-table">
                    <tr>
                        <th>Name</th>
                        <th>Amount (g)</th>
                        <th>Add (minutes)</th>
                        <th></th>
                    </tr>
                    <tr ng-repeat="hop in entry.hops" class="fade">
                        <td class="bl-table-data">{[{ hop.name }]}</td>
                        <td class="bl-table-data">{[{ hop.amount }]}</td>
                        <td class="bl-table-data">{[{ hop.add }]}</td>
                        <td class="bl-table-action">
                            <md-button class="md-icon-button md-accent" aria-label="-" ng-click="removeHop($event, hop)">
                                <md-icon md-svg-icon="{% static "img/remove.svg" %}"></md-icon>
                            </md-button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <md-input-container md-no-float flex-gt-sm="" class="md-block">
                              <input ng-model="hopName" placeholder="Name" type="text">
                            </md-input-container>
                        </td>
                        <td>
                            <md-input-container md-no-float flex-gt-sm="" class="md-block">
                              <input ng-model="hopAmount" placeholder="Amount" type="number">
                            </md-input-container>
                        </td>
                        <td>
                            <md-input-container md-no-float flex-gt-sm="" class="md-block">
                              <input ng-model="hopAdd" placeholder="Add" type="number">
                            </md-input-container>
                        </td>
                        <td class="bl-table-action">
                            <md-button class="md-icon-button md-accent" aria-label="+" ng-click="addHop()">
                                <md-icon md-svg-icon="{% static "img/add.svg" %}"></md-icon>
                            </md-button>
                        </td>
                    </tr>
                </table>

                <div class="bl-section" layout="row">
                    <img src="{% static "img/yeast.png" %}">
                    <h1>Yeast</h1>
                </div>
                <div layout-gt-sm="row">
                  <md-input-container flex-gt-sm="" class="md-block">
                    <label>Name</label>
                    <input ng-model="entry.yeast" type="text" ng-blur="updateYeast()">
                  </md-input-container>
                </div>
            </div>
        </div>
        <!-- end ingredients -->

        <!-- Method -->
        <div flex class="bl-block" layout="column">
            <div class="bl-header" layout="row">
                <h1>Method</h1>
            </div>
            <!-- Items -->
            <div layout="column" class="bl-method bl-column">
                <div class="bl-section" layout="row">
                    <img src="{% static "img/mash.png" %}">
                    <h1>Mash</h1>
                </div>
                <div layout-gt-sm="row">
                  <md-input-container class="md-block" flex-gt-sm="">
                    <label>Mash time (minutes)</label>
                    <input ng-model="entry.mash_time" type="number" ng-blur="updateMash()">
                  </md-input-container>
                </div>
                <div layout-gt-sm="row">
                  <md-input-container class="md-block" flex-gt-sm="">
                    <label>Sparge time (minutes)</label>
                    <input ng-model="entry.sparge_time" type="number" ng-blur="updateMash()">
                  </md-input-container>
                </div>
                <div class="bl-section" layout="row">
                    <img src="{% static "img/fermentation.png" %}">
                    <h1>Fermentation</h1>
                </div>
                <div layout-gt-sm="row">
                  <md-input-container class="md-block" flex-gt-sm="">
                    <label>Fermentation temperature (degrees Celsius)</label>
                    <input ng-model="entry.fermentation_temperature" type="number" ng-blur="updateFermentation()">
                  </md-input-container>
                </div>
                <div layout-gt-sm="row">
                  <md-input-container class="md-block" flex-gt-sm="">
                    <label>Fermentation time (days)</label>
                    <input ng-model="entry.fermentation_time" type="number" ng-blur="updateFermentation()">
                  </md-input-container>
                </div>
                <div class="bl-section" layout="row">
                    <img src="{% static "img/gravity.png" %}">
                    <h1>Gravity</h1>
                </div>
                <div layout-gt-sm="row">
                  <md-input-container class="md-block" flex-gt-sm="">
                    <label>O.G</label>
                    <input ng-model="entry.og" type="number" step="0.001" ng-blur="updateGravity()">
                  </md-input-container>
                </div>
                <div layout-gt-sm="row">
                  <md-input-container class="md-block" flex-gt-sm="">
                    <label>F.G</label>
                    <input ng-model="entry.fg" type="number" step="0.001" ng-blur="updateGravity()">
                  </md-input-container>
                </div>
                <div layout="column" class="bl-result">
                    <label for="attenuation">Attenuation</label>
                    <p><output id="attenuation" class="fade"></output>%</p>
                </div>
                <div layout="column" class="bl-result">
                    <label for="abv">ABV</label>
                    <p><output id="abv" class="fade"></output>%</p>
                </div>
            </div>
            <!-- end items -->
        </div>
        <!-- end method -->
    </div>
    <!-- end ingredients and method -->

    <!-- Log and comments -->
    <div layout="row" layout-xs="column" class="bl-content">

        <!-- Log -->
        <div flex class="bl-block" layout="column">
            <div class="bl-header" layout="row">
                <h1>Log</h1>
            </div>
            <div layout="column" class="bl-column">
                <table style="width:100%;" class="bl-table">
                    <tr>
                        <th>Start</th>
                        <th>End</th>
                        <th>Description</th>
                        <th></th>
                    </tr>
                    <tr ng-repeat="log in entry.logs" class="fade">
                        <td class="bl-table-data">{[{ log.start }]}</td>
                        <td class="bl-table-data">{[{ log.end }]}</td>
                        <td class="bl-table-data">{[{ log.description }]}</td>
                        <td class="bl-table-action">
                            <md-button class="md-icon-button md-accent" aria-label="-" ng-click="deleteLog($event, log)">
                                <md-icon md-svg-icon="{% static "img/remove.svg" %}"></md-icon>
                            </md-button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <md-input-container md-no-float flex-gt-sm="" class="md-block">
                              <input ng-model="logEntryStart" placeholder="Start" type="time">
                            </md-input-container>
                        </td>
                        <td>
                            <md-input-container md-no-float flex-gt-sm="" class="md-block">
                              <input ng-model="logEntryEnd" placeholder="End" type="time">
                            </md-input-container>
                        </td>
                        <td>
                            <md-input-container md-no-float flex-gt-sm="" class="md-block">
                              <input ng-model="logEntryDescription" placeholder="Description" type="text">
                            </md-input-container>
                        </td>
                        <td class="bl-table-action">
                            <md-button class="md-icon-button md-accent" aria-label="+" ng-click="addLog()">
                                <md-icon md-svg-icon="{% static "img/add.svg" %}"></md-icon>
                            </md-button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <!-- end log -->

        <!-- Comments -->
        <div flex class="bl-block" layout="column">
            <div class="bl-header" layout="row">
                <h1>Comments</h1>
            </div>
            <div layout="column" class="bl-column">
                <div ng-repeat="comment in entry.comments" layout="column" class="fade">
                    <!-- Comment -->
                    <div ng-hide="editedComments[comment.date]" layout="row">
                        <div style="width:100%; position:relative;" layout="column">
                            <div style="padding-bottom:5px;"><em>Written: {[{ comment.date | date:'dd-MM-yyyy HH:mm' }]}</em></div>
                            <div style="word-wrap:break-word; position:absolute; bottom:0;">{[{ comment.comment }]}</div>
                        </div>
                        <div style="float:right; width:110px;" layout="column">
                            <md-button class="md-primary" ng-click="editComment(comment)">Edit</md-button>
                            <md-button class="md-warn" ng-click="deleteComment($event, comment)">Delete</md-button>
                        </div>
                    </div>
                    <!-- Comment when editing -->
                    <div ng-if="editedComments[comment.date]" layout="row">
                        <div style="width:100%;" layout="column">
                            <md-input-container class="md-block" md-no-float>
                                <textarea class="comment-textarea" rows="5" id="{[{ 'comment' + comment.id }]}" aria-label="Comment">{[{ comment.comment }]}</textarea>
                            </md-input-container>
                        </div>
                        <div style="float:right; width:100px;" layout="column">
                            <md-button class="md-primary" ng-click="updateComment(comment)">Save</md-button>
                            <md-button class="md-warn" ng-click="editComment(comment)">Undo</md-button>
                        </div>
                    </div>
                    <span layout="row"><hr flex/></span>
                </div>

                <div layout="row">
                    <div style="width:100%;" layout="column">
                        <md-input-container class="md-block" md-no-float>
                            <textarea ng-model="newComment" rows="5" placeholder="Add comment"></textarea>
                        </md-input-container>
                    </div>
                    <div style="float:right; width:110px;" layout="column">
                        <md-button class="md-primary" ng-click="addComment()">Add</md-button>
                    </div>

                </div>
            </div>
        </div>
        <!-- end log -->
    </div>
    <!-- end log and comments -->

    <div style="padding:100px"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

  <!-- Angular Material requires Angular.js Libraries -->
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.min.js"></script>

  <!-- Angular Material Library -->
  <script src="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc4/angular-material.min.js"></script>

  <script src="{% static "js/brewlog.js" %}"></script>

</body>
</html>
